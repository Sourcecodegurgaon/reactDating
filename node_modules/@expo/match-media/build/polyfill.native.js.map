{"version":3,"file":"polyfill.native.js","sourceRoot":"","sources":["../src/polyfill.native.ts"],"names":[],"mappings":"AACA,OAAO,UAAU,MAAM,gBAAgB,CAAC;AACxC,OAAO,KAAK,iBAAiB,MAAM,yBAAyB,CAAC;AAC7D,OAAO,EAAE,UAAU,EAAE,MAAM,cAAc,CAAC;AAI1C,MAAM,UAAU;IAQd,YAAoB,KAAa;QAAb,UAAK,GAAL,KAAK,CAAQ;QAPzB,cAAS,GAAe,EAAE,CAAC;QAE3B,gBAAW,GACjB,iBAAiB,CAAC,WAAW,CAAC,WAAW,CAAC;QAoBpC,WAAM,GAAG,GAAG,EAAE;YACpB,IAAI,CAAC,eAAe,CAAC,EAAE,WAAW,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;QAC1D,CAAC,CAAC;QAjBA,aAAa;QACb,CAAC,KAAK,IAAI,EAAE;YACV,MAAM,WAAW,GAAG,MAAM,iBAAiB,CAAC,mBAAmB,EAAE,CAAC;YAClE,IAAI,CAAC,eAAe,CAAC,EAAE,WAAW,EAAE,CAAC,CAAC;QACxC,CAAC,CAAC,EAAE,CAAC;QAEL,IAAI,CAAC,WAAW,GAAG,iBAAiB,CAAC,4BAA4B,CAC/D,CAAC,EAAE,eAAe,EAAE,EAAE,WAAW,EAAE,EAAE,EAAE,EAAE;YACvC,IAAI,CAAC,eAAe,CAAC,EAAE,WAAW,EAAE,CAAC,CAAC;QACxC,CAAC,CACF,CAAC;QAEF,UAAU,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;IACrD,CAAC;IAMD,QAAQ;QACN,IAAI,IAAI,CAAC,WAAW;YAAE,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC;QAChD,UAAU,CAAC,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;IACxD,CAAC;IAEM,WAAW,CAAC,QAAkB;QACnC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAChC,CAAC;IAEM,cAAc,CAAC,QAAkB;QACtC,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAC/C,IAAI,KAAK,KAAK,CAAC,CAAC;YAAE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;IACpD,CAAC;IAED,aAAa;IACb,IAAW,OAAO;QAChB,MAAM,gBAAgB,GAAG,UAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAClD,OAAO,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,EAAE;YAClC,IAAI,EAAE,QAAQ;YACd,WAAW,EACT,IAAI,CAAC,WAAW,KAAK,iBAAiB,CAAC,WAAW,CAAC,cAAc;gBACjE,IAAI,CAAC,WAAW,KAAK,iBAAiB,CAAC,WAAW,CAAC,eAAe;gBAChE,CAAC,CAAC,WAAW;gBACb,CAAC,CAAC,UAAU;YAChB,GAAG,gBAAgB;YACnB,cAAc,EAAE,gBAAgB,CAAC,KAAK;YACtC,eAAe,EAAE,gBAAgB,CAAC,MAAM;SACzC,CAAC,CAAC;IACL,CAAC;IAEO,eAAe,CAAC,EAAE,WAAW,EAAE;QACrC,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QAC/B,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;YAChC,QAAQ,CAAC,IAAI,CAAC,CAAC;QACjB,CAAC,CAAC,CAAC;IACL,CAAC;CACF;AAED,IAAI,MAAM,EAAE;IACV,aAAa;IACb,MAAM,CAAC,UAAU,GAAG,gBAAgB,CAAC,EAAE,CAAC,IAAI,UAAU,CAAC,gBAAgB,CAAC,CAAC;CAC1E","sourcesContent":["import { Subscription } from \"@unimodules/core\";\nimport mediaQuery from \"css-mediaquery\";\nimport * as ScreenOrientation from \"expo-screen-orientation\";\nimport { Dimensions } from \"react-native\";\n\ntype Listener = (context: MediaQuery) => any;\n\nclass MediaQuery {\n  private listeners: Listener[] = [];\n\n  private orientation: ScreenOrientation.Orientation =\n    ScreenOrientation.Orientation.PORTRAIT_UP;\n\n  private unsubscribe: Subscription;\n\n  constructor(private query: string) {\n    // @ts-ignore\n    (async () => {\n      const orientation = await ScreenOrientation.getOrientationAsync();\n      this.updateListeners({ orientation });\n    })();\n\n    this.unsubscribe = ScreenOrientation.addOrientationChangeListener(\n      ({ orientationInfo: { orientation } }) => {\n        this.updateListeners({ orientation });\n      }\n    );\n\n    Dimensions.addEventListener(\"change\", this.resize);\n  }\n\n  private resize = () => {\n    this.updateListeners({ orientation: this.orientation });\n  };\n\n  _unmount() {\n    if (this.unsubscribe) this.unsubscribe.remove();\n    Dimensions.removeEventListener(\"change\", this.resize);\n  }\n\n  public addListener(listener: Listener) {\n    this.listeners.push(listener);\n  }\n\n  public removeListener(listener: Listener) {\n    const index = this.listeners.indexOf(listener);\n    if (index !== -1) this.listeners.splice(index, 1);\n  }\n\n  // @ts-ignore\n  public get matches(): boolean {\n    const windowDimensions = Dimensions.get(\"window\");\n    return mediaQuery.match(this.query, {\n      type: \"screen\",\n      orientation:\n        this.orientation === ScreenOrientation.Orientation.LANDSCAPE_LEFT ||\n        this.orientation === ScreenOrientation.Orientation.LANDSCAPE_RIGHT\n          ? \"landscape\"\n          : \"portrait\",\n      ...windowDimensions,\n      \"device-width\": windowDimensions.width,\n      \"device-height\": windowDimensions.height\n    });\n  }\n\n  private updateListeners({ orientation }) {\n    this.orientation = orientation;\n    this.listeners.forEach(listener => {\n      listener(this);\n    });\n  }\n}\n\nif (window) {\n  // @ts-ignore\n  window.matchMedia = mediaQueryString => new MediaQuery(mediaQueryString);\n}\n"]}